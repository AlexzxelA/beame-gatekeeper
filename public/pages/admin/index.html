<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Insta server admin dashboard</title>

    <link href="//kendo.cdn.telerik.com/2016.3.1118/styles/kendo.common.min.css" rel="stylesheet"/>
    <link href="//kendo.cdn.telerik.com/2016.3.1118/styles/kendo.flat.min.css" rel="stylesheet"/>

    <!-- Styles -->
    <!-- build:css -->
    <link rel="stylesheet" href="css/app.css">
    <!-- endbuild -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2016.3.1118/js/kendo.web.min.js"></script>
    <script src="lib/clipboard.min.js"></script>
    <script src="js/utils.js"></script>
    <script>
		var ADMIN_TEMPLATES = {
			Dash:    {
				path:  "templates/admin/dash.tmpl.html",
				event: "dashLoaded"
			},
			User:    {
				path:  "templates/admin/users.tmpl.html",
				event: "userLoaded"
			},
			Regs:    {
				path:  "templates/admin/registrations.tmpl.html",
				event: "regsLoaded"
			},
            Invitation:    {
				path:  "templates/admin/invitations.tmpl.html",
				event: "invitationLoaded"
			},
            RegToken:    {
				path:  "templates/admin/regtoken.tmpl.html",
				event: "tokenLoaded"
			},
			Service: {
				path:  "templates/admin/services.tmpl.html",
				event: "serviceLoaded"
			},
			GkLogin: {
				path:  "templates/admin/gk-login.tmpl.html",
				event: "loginsLoaded"
			}
		};

		//region future use
		var templateLoader = (function ($, host, event) {
			//Loads external templates from path and injects in to page DOM
			return {
				loadExtTemplate: function (path, event) {
					var tmplLoader = $.get(path)
						.success(function (result) {
							//Add templates to DOM
							$("body").append(result);
							//console.log(path + ' loaded')
						})
						.error(function (result) {
							alert("Error Loading Templates -- TODO: Better Error Handling");
						});

					tmplLoader.complete(function () {
						$(host).trigger(event, [path]);
						//console.log(path + ' complete')
					});
				}
			};
		})(jQuery, document);

		templateLoader.loadExtTemplate(ADMIN_TEMPLATES.Dash.path, ADMIN_TEMPLATES.Dash.event);
		templateLoader.loadExtTemplate(ADMIN_TEMPLATES.User.path, ADMIN_TEMPLATES.User.event);
		templateLoader.loadExtTemplate(ADMIN_TEMPLATES.Regs.path, ADMIN_TEMPLATES.Regs.event);
		templateLoader.loadExtTemplate(ADMIN_TEMPLATES.Invitation.path, ADMIN_TEMPLATES.Invitation.event);
		templateLoader.loadExtTemplate(ADMIN_TEMPLATES.RegToken.path, ADMIN_TEMPLATES.RegToken.event);
		templateLoader.loadExtTemplate(ADMIN_TEMPLATES.Service.path, ADMIN_TEMPLATES.Service.event);
		templateLoader.loadExtTemplate(ADMIN_TEMPLATES.GkLogin.path, ADMIN_TEMPLATES.GkLogin.event);


		$(document).ready(function () {
			var menu = $("#menu").kendoMenu();
			getSettings(function(){
				var isLogin = settings.AppConfig.IsCentralLoginMode;
				console.log('Is Login',isLogin);
				if(isLogin === "false"){

					$("#menu").data("kendoMenu").enable('#li-gk-login',false);
					$('#li-gk-login > a').unbind('click');
					$('#li-gk-login > a').attr("href","/#");

					//$('#li-gk-login').removeClass('k-state-default').addClass('k-state-disabled');
				}
			});

		});

        function showLoader(){
	        document.getElementById("overlay").style.display = "block";
        }
        function hideLoader(){
	        document.getElementById("overlay").style.display = "none";
        }

    </script>

    <style>
        .config-list {
            font-size: 13px
        }

        .config-list > li {
            padding: 5px 0
        }

        .config-list > li > label {
            width: 210px;
            display: inline-flex
        }
        .admin-main-wrapper{width: 100%}
        .admin-form-main{padding: 5px;margin: 0}
        .ad-success{color:green}
        .ad-error{color:red}
    </style>
</head>
<body>
<div class="admin-main-wrapper">

    <div class="row">
        <div class="column large-6 large-offset-1 end">
            <div class="logo"><a href="//www.beame.io/">
                <!-- build:logo -->
                <img src="../../img/logo.svg">
                <!-- endbuild -->
            </a>
            </div>
        </div>
    </div>

    <div class="row">


        <div id="toolbar">
            <nav>
                <ul id="menu">
                    <li><a id="showDash" href="#">Dashboard</a></li>
                    <li><a id="showUsers" href="#/users">Users</a></li>
                    <li><a id="showRegs" href="#/regs">Registrations</a></li>
                    <li><a id="showInvs" href="#/inv">Invitations</a></li>
                    <li><a id="showRegtoken" href="#/tkn">Reg Token</a></li>
                    <li><a id="showSrv" href="#/srvc">Services</a></li>
                    <li id="li-gk-login"><a id="showGkLogins" href="#/gk-login">GK Logins</a></li>
                    <li style="float: right"><a id="btn-logout" href="/beame-gw/logout">Logout</a></li>
                </ul>
            </nav>
            <div id="app-wrapper"></div>
        </div>

    </div>
</div>
<div id="overlay" class="overlay">
    <div>
        <h3>Processing Request</h3>
        <svg class="spinner" viewBox="0 0 50 50">
            <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
        </svg>
    </div>
</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/jszip/2.4.0/jszip.min.js"></script>

<script>

	var settings = null, viewDash, viewUsers, viewRegs, viewInvs,viewToken, viewService , viewGkLogin,layout;

	function initAdminRouters() {

		console.log('load admin routes');

		viewDash  = new kendo.View("#home", {model: settings});
		viewUsers = new kendo.View("#user");
		viewRegs  = new kendo.View("#regs");
		viewInvs  = new kendo.View("#inv");
		viewToken  = new kendo.View("#reg-token");
		viewService  = new kendo.View("#services");
		viewGkLogin  = new kendo.View("#gk-login");

		layout = new kendo.Layout("<section id='content'></section>");

		layout.render($("#app-wrapper"));


		function subscribe(event, callback) {
			$(document).bind(event, function (e, path) {
				//console.log(event + ' completed',path);
				callback();
			});
		}

		var initDash = function () {
			layout.showIn("#content", viewDash);
			loadSettings();
		};

		var initUsers = function () {
			layout.showIn("#content", viewUsers);
			loadUsers();
		};

		var initRegs = function () {
			layout.showIn("#content", viewRegs);
			loadRegs();
		};

		var initInvitations = function () {
			layout.showIn("#content", viewInvs);
			loadInvitations();
		};

		var initRegToken = function () {
			layout.showIn("#content", viewToken);
			loadRegToken();
		};

		var initServices = function () {
			layout.showIn("#content", viewService);
			loadServices();
		};

		var initGkLogins = function () {
			layout.showIn("#content", viewGkLogin);
			loadGkLogins();
		};

		$("#showDash").on("click", function () {
			initDash();
		});
		$("#showUsers").on("click", function () {
			initUsers();
		});
		$("#showRegs").on("click", function () {
			initRegs();
		});
		$("#showInvs").on("click", function () {
			initInvitations();
		});

		$("#showRegtoken").on("click", function () {
			initRegToken();
		});
		$("#showSrv").on("click", function () {
			initServices();
		});
		$("#showGkLogins").on("click", function () {
			initGkLogins();
		});

		var router = new kendo.Router({
			init: function () {
				layout.render("#app-wrapper");
			}
		});

		router.route("/", function () {
			subscribe(ADMIN_TEMPLATES.Dash.event, initDash);
		});

		router.route("/users", function () {
			subscribe(ADMIN_TEMPLATES.User.event, initUsers);
		});

		router.route("/regs", function () {
			subscribe(ADMIN_TEMPLATES.Regs.event, initRegs);
		});

		router.route("/inv", function () {
			subscribe(ADMIN_TEMPLATES.Invitation.event, initInvitations);
		});

		router.route("/tkn", function () {
			subscribe(ADMIN_TEMPLATES.RegToken.event, initRegToken);
		});

		router.route("/srvc", function () {
			subscribe(ADMIN_TEMPLATES.Service.event, initServices);
		});

		router.route("/gk-login", function () {
			subscribe(ADMIN_TEMPLATES.GkLogin.event, initGkLogins);
		});

		router.start();
	}

	initAdminRouters();

	function getSettings(cb){
		$.getJSON('/settings/get',function(data){
			console.log('Admin Settings data %j', data);
			settings = data;

			cb && cb();
		})
    }

</script>
</body>
</html>
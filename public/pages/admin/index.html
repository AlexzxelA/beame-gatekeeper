<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Insta server admin dashboard</title>

    <link href="//kendo.cdn.telerik.com/2016.3.1118/styles/kendo.common.min.css" rel="stylesheet"/>
    <link href="//kendo.cdn.telerik.com/2016.3.1118/styles/kendo.flat.min.css" rel="stylesheet"/>

    <!-- Styles -->
    <!-- build:css -->
    <link rel="stylesheet" href="css/app.css">
    <!-- endbuild -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2016.3.1118/js/kendo.web.min.js"></script>

    <script>
		var ADMIN_TEMPLATES = {
			Dash: {
				path:  "templates/admin/dash.tmpl.html",
				event: "dashLoaded"
			},
			User: {
				path:  "templates/admin/users.tmpl.html",
				event: "userLoaded"
			},
            Regs: {
				path:  "templates/admin/registrations.tmpl.html",
				event: "regsLoaded"
			}
		};

		//region future use
		var templateLoader = (function ($, host, event) {
			//Loads external templates from path and injects in to page DOM
			return {
				loadExtTemplate: function (path,event) {
					var tmplLoader = $.get(path)
						.success(function (result) {
							//Add templates to DOM
							$("body").append(result);
							//console.log(path + ' loaded')
						})
						.error(function (result) {
							alert("Error Loading Templates -- TODO: Better Error Handling");
						});

					tmplLoader.complete(function () {
						$(host).trigger(event, [path]);
						//console.log(path + ' complete')
					});
				}
			};
		})(jQuery, document);

		templateLoader.loadExtTemplate(ADMIN_TEMPLATES.Dash.path, ADMIN_TEMPLATES.Dash.event);
		templateLoader.loadExtTemplate(ADMIN_TEMPLATES.User.path, ADMIN_TEMPLATES.User.event);
		templateLoader.loadExtTemplate(ADMIN_TEMPLATES.Regs.path, ADMIN_TEMPLATES.Regs.event);


		$(document).ready(function () {
			$("#menu").kendoMenu();

		});

    </script>

    <style>
        .config-list {
            font-size: 13px
        }

        .config-list > li {
            padding: 5px 0
        }

        .config-list > li > label {
            width: 210px;
            display: inline-flex
        }
    </style>
</head>
<body>
<div class="main-wrapper">

    <div class="row">
        <div class="column large-6 large-offset-1 end">
            <div class="logo"><a href="//www.beame.io/">
                <!-- build:logo -->
                <img src="../../img/logo.svg">
                <!-- endbuild -->
            </a></div>
        </div>
    </div>

    <div class="row">


        <div id="toolbar">
            <nav>
                <ul id="menu">
                    <li><a id="showDash" href="#">Dashboard</a></li>
                    <li><a id="showUsers" href="#/users">Users</a></li>
                    <li><a id="showRegs" href="#/regs">Registrations</a></li>
                </ul>
            </nav>
            <div id="app-wrapper"></div>
        </div>

    </div>
</div>


<script src="lib/jszip.min.js"></script>

<script>

	var settings = null,viewDash,viewUsers,viewRegs,layout;

	function initAdminRouters() {
		viewDash  = new kendo.View("home",{model:settings});
		viewUsers = new kendo.View("#user");
		viewRegs  = new kendo.View("#regs");

		layout = new kendo.Layout("<section id='content'></section>");

		layout.render($("#app-wrapper"));


		function subscribe(event,callback){
			$(document).bind(event, function(e, path) {
				//console.log(event + ' completed',path);
				callback();
			});
		}

		var initDash = function(){
			layout.showIn("#content", viewDash);
			loadSettings();
		};

		var initUsers = function(){
			layout.showIn("#content", viewUsers);
			loadUsers();
		};

		var initRegs = function(){
			layout.showIn("#content", viewRegs);
			loadRegs();
		};

		$("#showDash").on("click", function () {
			initDash();
		});
		$("#showUsers").on("click", function () {
			initUsers();
		});
		$("#showRegs").on("click", function () {
			initRegs();
		});

		var router = new kendo.Router({
			init: function () {
				layout.render("#app-wrapper");
			}
		});

		router.route("/", function () {
			subscribe(ADMIN_TEMPLATES.Dash.event,initDash);
		});
		router.route("/users", function () {
			subscribe(ADMIN_TEMPLATES.User.event,initUsers);
		});
		router.route("/regs", function () {
			subscribe(ADMIN_TEMPLATES.Regs.event,initRegs);
		});

		router.start();
	}

	initAdminRouters();

</script>
</body>
</html>
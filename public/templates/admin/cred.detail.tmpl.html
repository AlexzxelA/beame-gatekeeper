

<script type="text/x-kendo-template" id="tmpl-cred-detail">


    <h4>Cred Details</h4>
    <section id="cred-form-container" style="margin-bottom: 50px">
        <form id="cred-detail-form" class="form-main admin-form-main">
            <div id="pfx-info">&nbsp;</div>
            <label class="lbl-info">Fqdn: <span data-bind="text: data.fqdn"></span></label>
            <label class="lbl-info">Valid till: <span data-bind="text: data.validTill"></span></label>
            <label class="lbl-info" data-bind="visible:data.parent_fqdn,attr:{title:data.parent_fqdn}">Parent: <span data-bind="text:parentName()"></span></label>
            <label class="lbl-info">Name: <span data-bind="text: data.name"></span></label>
            <label class="lbl-info">Email: <span data-bind="text: data.email"></span></label>
            <label class="lbl-info" data-bind="visible:data.pwd" >Pfx Pwd: <span data-bind="text: data.pwd"></span></label>
            <a data-bind="attr: { href: data.pfx_path },visible:data.pfx_path" target="_blank" >Download Pfx</a>

            <!--<input type="button" name="btn-renew" value="Renew" class="button">-->
            <!--<input type="button" name="btn-revoke" value="Revoke" class="button">-->
            <!--<input type="button" data-bind="visible:data.isLocal" name="btn-purge" value="Purge" class="button">-->
        </form>

        <form id="send_pfx_form" action="/send/pfx" data-bind="visible:data.pwd" method="post" class="form-main admin-form-main">
            <div id="send_pfx_form_info">&nbsp;</div>
            <input name="email" required type="email" placeholder="Email" data-bind="value: data.email" class="form-input"/>
            <input name="fqdn" required type="hidden" data-bind="value: data.fqdn" />
            <input type="submit" name="btn-email" value="Send Pfx by Email" class="button">
        </form>
    </section>

</script>
<script>

	function loadCredDetail(data) {

        console.log('load cred details',data);

		var viewModel = kendo.observable({
            init:function(){
	            $('#send_pfx_form').submit(function () {

		            showLoader();

		            var handleSendCredResponse = function (response) {
			            hideLoader();
			            console.log(response);
			            if (response.responseCode == 1) {
				            response.responseDesc = 'Email sent to ' + ( $('#send_pfx_form input[name="email"]').val()) ;
				            $("#send_pfx_form_info").removeClass('ad-error').addClass('ad-success');

			            }
			            else {
				            $("#send_pfx_form_info").removeClass('ad-success').addClass('ad-error');

			            }
			            $("#send_pfx_form_info").html(response.responseDesc);
		            };


		            $(this).ajaxSubmit({
			            error:   handleSendCredResponse,
			            success: handleSendCredResponse
		            });

		            return false;
	            });
            },
			data:data,
            parentName: function(){
			    return this.data.parent_name || this.data.parent_fqdn
            },
            sendPfxUrl:function(){
            	return '/send/pfx/' + this.data.fqdn
            }
		});
		console.log('load viewModel',viewModel);
		kendo.bind($("#cred-form-container"), viewModel);
		viewModel.init();
	}
</script>
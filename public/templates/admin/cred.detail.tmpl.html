<!--suppress ALL -->
<style>

    .metrotable{
        table-layout: fixed;
        width: 100%;
    }

    .metrotable > thead > tr > th {
        padding: 2em 1em 0 0;
        text-transform: lowercase;
        text-align: left;
        font-size: 2em;
        font-weight: lighter;
        color: #bbb;
        border-bottom: 1px solid #ccc;
    }

    .metrotable > tbody > tr > td {
        padding: .5em 1em .5em 0;
        text-transform: lowercase;
        text-align: left;
        font-size: 1.2em;
        font-weight: lighter;
        color: #787878;
        border-bottom: 1px solid #e1e1e1;
    }

    .metrotable > tbody > tr > td {
        font-size: 12px;
    }

    .metrotable > thead > tr > th {
        font-size: 14px;
        padding-top: 0;
    }

    #inv-qr > div{margin: 0 auto;}

    /* Success template */
    .k-notification-success.k-group {
        background: rgba(0%,60%,0%,.7);
        color: #fff;
    }
    .notif-success {
        width: 300px;
        height: 100px;
        padding: 0 30px;
        line-height: 100px;
    }
    .notif-success h3 {
        font-size: 13px;
        font-weight: normal;
        display: inline-block;
        vertical-align: middle;
    }
    .notif-success img {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
        width: 20px;height: 20px;
    }

    /* Error template */
    .k-notification-error.k-group {
        background: rgba(100%,0%,0%,.7);
        color: #ffffff;
    }
    .notif-error {
        width: 300px;
        height: 100px;
        padding: 0 30px;
        line-height: 100px;
    }
    .notif-error h3 {
        font-size: 13px;
        font-weight: normal;
        display: inline-block;
        vertical-align: middle;
    }
    .notif-error img {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
        width: 20px;height: 20px;
    }
</style>

<script id="tmpl-cred-detail" type="text/x-kendo-template">
    <h4>Cred Details</h4>
    <section id="cred-form-container" style="margin-bottom: 50px">
        <form id="cred-detail-form" class="admin-form-main">
            <div id="cred-info" class="invisible-msg">&nbsp;</div>
            <label class="lbl-info">Fqdn: <span id="hid-fqdn">https://<span data-bind="text: data.fqdn"></span> </span> <input id="copy-fqdn-btn" type="button"  value="Copy to clipboard" class="k-button" data-clipboard-action="copy"/></label>
            <label class="lbl-info">Valid till: <span data-bind="text: data.validTill"></span></label>
            <label class="lbl-info">Revoked: <input type="checkbox" disabled data-bind="checked: data.revoked"/></label>
            <label class="lbl-info" data-bind="visible:data.parent_fqdn,attr:{title:data.parent_fqdn}">Parent: <span data-bind="text:parentName()"></span></label>
            <label class="lbl-info">Name: <span data-bind="text: data.name"></span></label>
            <label class="lbl-info">Email: <span data-bind="text: data.email"></span></label>
            <label class="lbl-info" data-bind="visible:data.pwd">Pfx Pwd: <span data-bind="text: data.pwd"></span></label>
        </form>

        <div class="btn-row">
            <h5>Cert Actions</h5>
            <input type="button" data-bind="click:openCertWnd" value="Cert Details" class="k-button">
            <input type="button" name="btn-renew" data-bind="disabled:renewButtonDisabled,click:renewCert" value="Renew" class="k-button">
            <input type="button" name="btn-revoke" data-bind="disabled:revokeDisabled,click:revokeCert" value="Revoke" class="k-button">
            <input type="button" data-bind="click:checkOcsp" value="Check Ocsp" class="k-button">
            <input type="button" disabled data-bind="visible:data.isLocal" name="btn-purge" value="Purge" class="k-button">
        </div>

        <div class="btn-row"  data-bind="visible:showValidCertForms">
            <h5>Cred Actions</h5>
            <input type="button" data-bind="disabled:commonButtonDisabled,click:openCredWnd" value="Create Child" class="k-button">
            <input type="button" data-bind="disabled:commonButtonDisabled,click:openInvitationWnd" value="Create Invitation" class="k-button">
            <input type="button" data-bind="disabled:commonButtonDisabled,click:openRegtokenWnd" value="Create Registration Token" class="k-button">
        </div>


        <div class="btn-row" data-bind="visible:showValidCertForms">
            <h5>Share Cred</h5>
            <form id="frm-send-pfx-email" action="/send/pfx" data-bind="visible:emailFormVisible" method="post" class="admin-form-main">
                <div id="send_pfx_form_info" class="invisible-msg">&nbsp;</div>
                <input name="email" required type="email" placeholder="Email" data-bind="disabled:commonButtonDisabled,value: data.email" class="form-input"/>
                <input name="fqdn" required type="hidden" data-bind="value: data.fqdn"/>
                <input type="button" id="btn-send-pfx-email" name="btn-email" data-bind="disabled:commonButtonDisabled" value="Send Pfx by Email" class="k-button">
            </form>
            <div >
                <input type="button" name="btn-qr" data-bind="disabled:commonButtonDisabled,click: showCredQr" value="Show QR" class="k-button">
                <a data-bind="attr: { href: data.pfx_path },visible:data.pfx_path" target="_blank" class="k-button inline">Download Pfx</a>
            </div>
        </div>

        <div class="btn-row" data-bind="visible:showDns">
            <h5>DNS</h5>
            <div data-bind="visible:availableDnsRecords.length">
                <form id="frm-create-dns" action='/dns/create' data-bind="visible:showValidCertForms" method="post" class="form-main admin-form-main add-dns-form">
                    <label class="lbl-info">Add DNS Record</label>
                    <input name="dnsFqdn"
                           id="dnsFqdn"
                           style="width:100%"
                           placeholder="Select fqdn"
                           required
                           data-role="combobox"
                           data-auto-bind="false"
                           data-text-field="fqdn"
                           data-value-field="fqdn"
                           data-bind="value:dnsFqdn,source:availableDnsRecords"

                    />
                    <div style="height: 40px">
                        <label class="secondary-label" style="width: 100px">Use Beame edge </label> <input type="radio"  name="dns-method-radio" data-bind="attr:{value:dnsMethods.BeameEdge}, checked:selectedDnsMethod, click:onDnsMethodChanged" />
                    </div>

                    <div style="height: 40px">
                        <label class="secondary-label" style="width: 100px">Custom</label>  <input type="radio" value="1" name="dns-method-radio" data-bind="attr:{value:dnsMethods.Custom}, checked:selectedDnsMethod, click:onDnsMethodChanged" />
                        <input type="text" name="dnsValue" placeholder="Value: CN or IP" class="k-input" data-bind="value:dnsValue, enabled:dnsValueEnabled" style="width: 350px"/>
                    </div>

                    <input type="hidden" name="fqdn" data-bind="value:data.fqdn">
                    <div id="frm-dns-info" class="invisible-msg">&nbsp;</div>
                    <input type="button" id="btn-create-dns" value="Create Dns Record" class="k-primary">
                </form>
            </div>
            <table class="metrotable">
                <thead>
                <tr>
                    <th style="width: 42%">Fqdn</th>
                    <th style="width: 48%">Value</th>
                    <th style="width: 5%"></th>
                    <th style="width: 5%"></th>
                </tr>
                </thead>
                <tbody data-role="listview"
                       data-edit-template="tmpl-edit-dns-row"
                       data-template="tmpl-dns-row"
                       data-bind="source: dnsRecords,
                            events: {
                              edit: onDnsEdit,
                                remove:confirmDelete
                            }"
                >
                </tbody>
            </table>

        </div>


        <div class="btn-row" data-bind="visible:showValidCertForms">
            <h5>VPN Actions</h5>
            <input type="button" name="btn-set-vpn" data-bind="disabled:commonButtonDisabled,click:opneVPN" value="Set VPN" class="k-button">
            <form id="ios-profile-form" method="get" style="margin: 15px 0" target="_blank" data-bind="visible:iosVpnProfileVisible">
                <div id="ios-profile-info">&nbsp;</div>
                <input type="submit" class="k-button" id="btn-ios-profile" value="Download IOS VPN  profile"/>
                <input type="button" name="btn-qr" data-bind="disabled:commonButtonDisabled,click: showIosProfileQr" value="Show Profile QR" class="k-button">
            </form>

        </div>

        <div data-bind="visible:data.actions.length">
            <h5>History</h5>
            <table class="metrotable">
                <thead>
                <tr>
                    <th>Action</th>
                    <th>Email</th>
                    <th>Name</th>
                    <th>Fqdn</th>
                    <th>Value</th>
                    <th>Date</th>
                </tr>
                </thead>
                <tbody data-template="history-row-template" data-bind="source: data.actions"></tbody>
            </table>
        </div>

    </section>


</script>

<script id="vpn-detail" type="text/x-kendo-template">
    <label class="lbl-info">Fqdn: <span data-bind="text:data.fqdn"></span></label>
    <form id="frm-vpn-detail" method="post" action="/cred/set-vpn/create" class="admin-form-main" style="width:400px">
        <div id="frm-vpn-detail_info" class="invisible-msg">&nbsp;</div>
        <input type="hidden" name="vpn_id" data-bind="value:vpnId">
        <input name="name" required type="text" placeholder="VPN ID" data-bind="value:name" class="form-input"/>
        <input name="fqdn" required type="hidden" data-bind="value: data.fqdn"/>
        <input type="submit" name="btn-set-vpn" value="Set VPN" class="k-button">
        <input type="button" name="btn-set-vpn" data-bind="enabled: vpnId,click:deleteVpn" value="Delete VPN" class="k-button">
    </form>

    <form id="frm-vpn-delete" method="post" action="/cred/set-vpn/delete">
        <input name="vpn_id" type="hidden" data-bind="value:vpnId">
        <input name="name" type="hidden" data-bind="value:name"/>
        <input name="fqdn" type="hidden" data-bind="value:data.fqdn"/>
    </form>


    <div id="wnd-overlay" class="overlay" style="max-height: 100% !important">
        <div>
            <h3>Processing Request</h3>
            <svg class="spinner" viewBox="0 0 50 50">
                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
            </svg>
        </div>
    </div>
</script>

<script id="history-row-template" type="text/x-kendo-template">
    <tr>
        <td data-bind="text: action"></td>
        <td data-bind="text: email"></td>
        <td data-bind="text: name"></td>
        <td>
            <span data-bind="text: fqdn, attr:{title:fqdn}" class="overflow"></span>
        </td>
        <td>
            <span data-bind="text: value, attr:{ title:value}" class="overflow"></span>
        </td>
        <td data-bind="text: dateStr"></td>
    </tr>
</script>

<script id="tmpl-create-child-cred" type="text/x-kendo-template">
    <form id="frm-create-child-cred" action='/cred/create' method="post" class="form-main admin-form-main">
        <label class="lbl-info">Create child credential for</label>
        <label class="lbl-info">Fqdn: <span data-bind="text:data.fqdn"></span></label>
        <label class="lbl-info">Name: <span data-bind="text:data.name"></span></label>
        <input name="name" placeholder="Name" class="form-input" data-bind="value:name"/>
        <input name="email" type="email" placeholder="Email" class="form-input" data-bind="value:email"/>
        <input name="password" placeholder="Pfx Password (min 8 chars)" pattern=".{8,16}" data-bind="value:password" class="form-input"/>
        <label class="inline form-input" style="border: none;box-shadow: none">Send cred by email <input type="checkbox" data-bind="checked:sendEmail,enabled:email" disabled/></label>
        <div id="create-child-cred-info" class="invisible-msg">&nbsp;</div>
        <input type="button" value="Create Certificate" class="k-primary" data-bind="click:createCred">
    </form>
    <div id="wnd-overlay" class="overlay" style="max-height: 100% !important">
        <div>
            <h3>Processing Request</h3>
            <svg class="spinner" viewBox="0 0 50 50">
                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
            </svg>
        </div>
    </div>
</script>

<script id="tmpl-create-regtoken" type="text/x-kendo-template">
    <form id="frm-create-regtoken" action='/regtoken/create' method="post" class="form-main admin-form-main">

        <label class="lbl-info">Create registration token signed by</label>
        <label class="lbl-info">Fqdn: #: fqdn#</label>
        # if(name) {#
        <label class="lbl-info">Name: #: name#</label>
        # } #
        <input id="fqdn" type="hidden" name="fqdn" value="#: fqdn#"/>
        <input name="name" placeholder="Name" class="form-input"/>
        <input name="email" type="email" placeholder="Email" class="form-input"/>
        <input name="user_id" placeholder="External user ID" class="form-input"/>
        <input name="ttl" placeholder="Token TTL in seconds" class="form-input"/>

        <div id="token-info" class="invisible-msg">&nbsp;</div>
        <input type="button" value="Create Registration Token" class="k-primary" id="btn-create-regtoken">
    </form>

    <div id="reg-token-container" style="display:none;" class="form-main admin-form-main">
        <input type="button" id="btn-regtoken-back" value="back">
        <input id="copy-btn" type="submit" name="submit" value="Copy to clipboard" class="k-button" data-clipboard-action="copy"/>
        <textarea id="reg_token" name="reg_token" style="width: 80%;margin: 15px 0 0;" rows="10"></textarea>
    </div>

    <div id="wnd-overlay" class="overlay" style="max-height: 100% !important">
        <div>
            <h3>Processing Request</h3>
            <svg class="spinner" viewBox="0 0 50 50">
                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
            </svg>
        </div>
    </div>
</script>

<script id="tmpl-create-invitation" type="text/x-kendo-template">
    <h4>Create Invitation</h4>
    <section id="inv-form-container" style="margin-bottom: 50px">
        <form id="frm-create-invitation" method="post" class="form-main admin-form-main">
            <div id="inv-info">&nbsp;</div>
            <input name="name" placeholder="Name" class="form-input" data-bind="value:name"/>
            <input name="email" type="email" placeholder="Email"  data-bind="value:email" class="form-input"/>
            <input name="user_id" placeholder="External user ID"  data-bind="value:user_id" class="form-input"/>
            <label class="inline form-input" style="border: none;box-shadow: none">Send invitation by email <input type="checkbox" data-bind="checked:sendEmail,enabled:email" disabled/></label>
            <input type="button" id="btn-create-invitation" data-bind="click:createInvitation" value="Invite" class="button">
        </form>
    </section>

    <div id="inv-qr-container" style="display:none;text-align: center" class="form-main admin-form-main">
        <input type="button" id="btn-inv-back" value="back" data-bind="click:back">
        <div id="inv-qr" style="margin: 10px auto 0;"></div>
    </div>

    <div id="wnd-overlay" class="overlay" style="max-height: 100% !important">
        <div>
            <h3>Processing Request</h3>
            <svg class="spinner" viewBox="0 0 50 50">
                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
            </svg>
        </div>
    </div>
</script>

<script id="tmpl-cert-detail" type="text/x-kendo-template">
    <div class="cert-wnd-container">
        <div class="cert-header">
            <img class="float-left" src="img/cert.png" width="64" height="53">
            <div class="float-left">
                <h4 class="crop">#: commonName #</h4>
                <div>Issued by: #: issuer.commonName #</div>
                <div>Expires: #: notAfter #</div>
                <div class="gray">
                    # if(isValid) {#
                    <img class="vmiddle" src="img/ok.png" width="10" height="10">&nbsp;<span class="vmiddle">This certificate is valid</span>
                    #} else {#
                    <img class="vmiddle" src="img/bad.svg" width="16" height="16">&nbsp;
                    # if(expired) {#
                    <span class="vmiddle">This certificate is expired</span>
                    # }

                    if(revoked) {#
                    <span class="vmiddle">This certificate is revoked</span>
                    # }
                    } #
                </div>
            </div>
        </div>

        <div class="cert-content">

            <p class="bold"><span class="pointer">▼</span>&nbsp;Details</p>

            <div class="title-divider">
                <span>Subject name</span>
                <span>&nbsp;</span>
            </div>

            <div>
                <span>Country</span>
                <span>#: subject.country #</span>
            </div>

            <div>
                <span>State/Province</span>
                <span>#: subject.state #</span>
            </div>

            <div>
                <span>Locality</span>
                <span>#: subject.locality #</span>
            </div>

            <div>
                <span>Organization</span>
                <span>#: subject.organization #</span>
            </div>

            <div>
                <span>Common Name</span>
                <span>#: subject.common #</span>
            </div>


            <div class="title-divider">
                <span>Issuer Name</span>
                <span>&nbsp;</span>
            </div>

            <div>
                <span>Country</span>
                <span>#: issuer.country #</span>
            </div>

            <div>
                <span>Organization</span>
                <span>#: issuer.organization #</span>
            </div>

            <div>
                <span>Common Name</span>
                <span>#: issuer.commonName #</span>
            </div>


            <div>
                <span>Serial Number</span>
                <span>#: serial #</span>
            </div>

            <div>
                <span>Signature Algorithm</span>
                <span>#: signatureAlgorithm #</span>
            </div>

            <div class="title-divider">
                <span></span>
                <span></span>
            </div>

            <div class="title-light">
                <span>Extension</span>
                <span>Key Usage</span>
            </div>


            <div>
                <span>Usage</span>
                <span>#: extensions.keyUsage#</span>
            </div>


            <div class="title-light">
                <span>Extension</span>
                <span>Subject Key Identifier ( 2.5.29.14 )</span>
            </div>

            <div>
                <span>Key ID</span>
                <span>#: extensions.subjectKeyIdentifier #</span>
            </div>


            <div class="title-light">
                <span>Extension</span>
                <span>Subject Alternative Name ( 2.5.29.17 )</span>
            </div>

            # for (var i = 0; i < altNames.length; i++) { #
            <div>
                # if(i >0) { #
                <span>&nbsp;</span>
                # } else { #
                <span>DNS Names</span>
                # } #

                <span>#= altNames[i] #</span>
            </div>
            # } #


        </div>
    </div>
</script>

<script id="tmpl-dns-row" type="text/x-kendo-template">
    <tr>
        <td style="width: 42%">#: fqdn #</td>
        <td style="width: 48%">#: value #</td>
        <td style="width: 5%"><a class="k-button k-edit-button" data-bind="visible:showValidCertForms" href="\\#"><span class="k-icon k-i-edit"></span></a>
        </td>
        <td style="width: 5%"><a class="k-button k-delete-button" href="\\#" data-bind="click:deleteDns"><span class="k-icon k-i-delete"></span></a></td>
    </tr>
</script>

<script id="tmpl-edit-dns-row" type="text/x-kendo-template">
    <tr>
        <td style="width: 42%">#: fqdn#</td>
        <td style="width: 48%">
            <input type="text" class="k-textbox" data-bind="value:value" name="value" style="width:98%;"/>
        </td>
        <td style="width: 5%">
            <a class="k-button k-update-button dns-update" href="\\#"><span class="k-icon k-i-check"></span></a>
        </td>
        <td style="width: 5%"><a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-i-cancel"></span></a>
        </td>
    </tr>
</script>

<script id="errorTemplate" type="text/x-kendo-template">
    <div class="notif-error">
        <img src="img/forbidden.png" />
        <h3>#= message #</h3>
    </div>
</script>

<script id="successTemplate" type="text/x-kendo-template">
    <div class="notif-success">
        <img src="img/button-accept.png" />
        <h3>#= message #</h3>
    </div>
</script>

<div id="qr-window" class="wnd-default">
    <div id="download-qr" style="margin: auto;width: 300px"></div>
</div>

<div id="vpn-window" class="wnd-default"></div>

<div id="cert-window" class="wnd-default"></div>

<div id="create-child-cred-window" class="wnd-default"></div>

<div id="create-invitation-window" class="wnd-default"></div>

<div id="create-regtoken-window" class="wnd-default"></div>

<div id="d-notif" style="width: 340px;height: 100px;"></div>

<!-- Scripts -->
<!-- build:admin-template -->
<script src="js/admin/cred.detail.js"></script>
<!-- endbuild -->
<script type="text/x-kendo-template" id="inv">
    <h4>Create Invitation</h4>
    <div id="inv-form-container">
        <ul class="config-list">
            <li>
                <label>Service name</label>
                <input type="text" class='k-textbox' data-bind="value: data.AppConfig.ServiceName"
                       id="ServiceName"/>
            </li>
        </ul>
    </div>

    <h4>Invitations Report</h4>
    <div id="inv-grid"></div>
</script>
<script>
	function loadInvitations() {

		$("#inv-grid").kendoGrid({
			toolbar:    ["excel"],
			excel:      {
				fileName: "Registrations.xlsx",
				allPages: true
			},
			dataSource: {
				transport: {
					read:    {
						url: "/registration/list"
					},
					destroy: {
						url:      "/registration/destroy",
						method:   "POST",
						dataType: "json"
					}
				},
				schema:    {
					model: {
						id:     "id",
						fields: {
							id:        {type: "number"},
							name:      {type: "string"},
							email:     {type: "string"},
							fqdn:      {type: "string"},
							createdAt: {type: "date"},
							source:    {type: "string"},
							completed: {type: "boolean"}
						}
					}
				},
				pageSize:  20,
//                serverPaging:    true,
//                serverFiltering: true,
//                serverSorting:   true
			},
			height:     550,
			filterable: true,
			sortable:   true,
			editable:   {
				mode:         "inline",
				confirmation: true
			},
			dataBound: function(e) {
				var grid = e.sender;
				var data = grid.dataSource.data();
				$.each(data, function (i, item) {
					if (item.completed ) {
						$('tr[data-uid="' + item.uid + '"] ').find('.k-grid-delete').hide();//.addClass("disabled");
					}

				});
			},
			remove: function(e) {
				if (e.model.completed) {
					e.preventDefault();
					alert("Registration is completed, and can't be removed");

				}
			},
			pageable:   {
				pageSize: 20,
				refresh:  true
			},
			columns:    [{
				field:      "id",
				filterable: false
			},
				{
					field: "name",
					title: "Name"
				},
				{
					field: "email",
					title: "Email"
				},

				{
					field: "fqdn",
					title: "Fqdn"
				},
				{
					field: "source",
					title: "Source"
				},
				{
					field: "completed",
					title: "Completed"
				},
				{
					field:  "createdAt",
					title:  "Add On",
					format: "{0:MM/dd/yyyy}"
				},
				{command: "destroy", title: "&nbsp;", width: 100}
			]
		});
	}
</script>
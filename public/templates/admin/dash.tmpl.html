<script type="text/x-kendo-template" id="home">

    <div style="padding: 10px">
        <h4>Service: <span data-bind="text: data.AppConfig.ServiceName"></span></h4>

        <h5>AppId: <span data-bind="text: data.AppConfig.AppId"></span></h5>

        <ul id="panelbar" style="width: 600px;display: none;">
            <li>
                Creds
                <div style="padding: 7px">
                    <ul class="config-list">
                        <li>
                            <label>Zero Level</label>
                            <span data-bind="text:data.Creds.ZeroLevel.fqdn"></span>
                        </li>

                        <li>
                            <label>Gateway Server</label>
                            <span data-bind="text:data.Creds.GatewayServer.fqdn"></span>
                        </li>

                        <!--<li>-->
                            <!--<label>Admin Server</label>-->
                            <!--<span data-bind="text:data.Creds.AdminServer.fqdn"></span>-->
                        <!--</li>-->

                        <li>
                            <label>Beame Authorization Server</label>
                            <span data-bind="text:data.Creds.BeameAuthorizationServer.fqdn"></span>
                        </li>

                        <li>
                            <label>Matching Server</label>
                            <span data-bind="text:data.Creds.MatchingServer.fqdn"></span>
                        </li>
                    </ul>
                </div>
            </li>
            <li>
                AppConfig

                <div style="padding: 7px">
                    <ul class="config-list">
                        <li>
                            <label>Service name</label>
                            <input type="text" class='k-textbox' data-bind="value: data.AppConfig.ServiceName" id="ServiceName"/>
                        </li>

                        <li>
                            <label>Registration method</label>
                            <!--<input data-role="dropdownlist"-->
                                   <!--data-auto-bind="true"-->
                                   <!--data-value-primitive="true"-->
                                   <!--data-text-field="name"-->
                                   <!--data-value-field="name"-->
                                   <!--data-bind="value: data.AppConfig.RegistrationMethod, source: data.RegMethods"-->
                                   <!--class='k-textbox'-->
                            <!--/>-->
                            <input data-role="dropdownlist" data-auto-bind="true" data-value-primitive="true" data-text-field="name" data-value-field="name" data-bind="value: data.AppConfig.RegistrationMethod, source: data.RegMethods" class="k-textbox">
                        </li>

                        <li>
                            <label>Environment Mode</label>
                            <input data-role="dropdownlist"
                                   data-auto-bind="true"
                                   data-value-primitive="true"
                                   data-text-field="name"
                                   data-value-field="name"
                                   data-bind="value: data.AppConfig.EnvMode, source: data.EnvModes"
                                   class='k-textbox'
                            />
                        </li>

                        <li>
                            <label>Allow Public Registration</label>
                            <input type="checkbox" data-bind="checked:data.AppConfig.PublicRegistration" />
                        </li>


                        <li>
                            <label>Use Image Authentication</label>
                            <input type="checkbox" data-bind="checked:data.AppConfig.RegistrationImageRequired" />
                        </li>

                        <li>
                            <label>Encrypt User Data</label>
                            <input type="checkbox" data-bind="checked:data.AppConfig.EncryptUserData" />
                        </li>

                        <li>
                            <label>Beame Auth  server on local</label>
                            <input type="checkbox" data-bind="checked:data.AppConfig.UseBeameAuthOnLocal" />
                        </li>

                        <li>
                            <label>Start Raspberry app</label>
                            <input type="checkbox" data-bind="checked:data.AppConfig.StartRaspberryApp" />
                        </li>

                        <li>
                            <label>Pairing Required</label>
                            <input type="checkbox" data-bind="checked:data.AppConfig.PairingRequired" />
                        </li>

                        <li>
                            <label>Allow Direct Signin</label>
                            <input type="checkbox" data-bind="checked:data.AppConfig.AllowDirectSignin" />
                        </li>

                        <li>
                            <label>External Matching Fqdn</label>
                            <textarea  data-bind="value:data.AppConfig.ExternalMatchingFqdn"  class='k-textbox' id="ExternalMatchingFqdn" cols="30" rows="2"></textarea>
                        </li>


                        <li>
                            <label>Email post url</label>
                            <textarea  data-bind="value:data.AppConfig.PostEmailUrl"  class='k-textbox' id="PostEmailUrl" cols="30" rows="2"></textarea>
                        </li>

                        <li>
                            <label>Email send cert url</label>
                            <textarea  data-bind="value:data.AppConfig.EmailSendCertUrl"  class='k-textbox' id="EmailSendCertUrl" cols="30" rows="2"></textarea>
                        </li>

                        <li>
                            <label>External login server URL</label>
                            <textarea  data-bind="value:data.AppConfig.ExternalLoginServer"  class='k-textbox' id="ExternalLoginServer" cols="30" rows="2"></textarea>
                        </li>

                        <li>
                            <label>OCSP cache period (days)</label>
                            <input data-role="numerictextbox" data-bind="value:data.AppConfig.OcspCachePeriod"
                                   id="OcspCachePeriod" type="text" data-spinners="false" data-format="{0:D}"/>
                        </li>

                        <li>
                            <label>Customer Invitation Ttl (sec)</label>
                            <input data-role="numerictextbox" data-bind="value:data.AppConfig.CustomerInvitationTtl"
                                   id="CustomerInvitationTtl" type="text" data-spinners="false" data-format="{0:D}"/>
                        </li>

                        <li>
                            <label>Browser Session Ttl (sec)</label>
                            <input data-role="numerictextbox" data-bind="value:data.AppConfig.BrowserSessionTtl"
                                   id="BrowserSessionTtl" type="text" data-spinners="false" data-format="{0:D}"/>
                        </li>

                        <li>
                            <label>Proxy Initiating Ttl (sec)</label>
                            <input data-role="numerictextbox" data-bind="value:data.AppConfig.ProxyInitiatingTtl"
                                   id="ProxyInitiatingTtl" type="text" data-spinners="false" data-format="{0:D}"/>
                        </li>

                        <li>
                            <label>Proxy Session Ttl (sec)</label>
                            <input data-role="numerictextbox" data-bind="value:data.AppConfig.ProxySessionTtl"
                                   id="ProxySessionTtl" type="text" data-spinners="false" data-format="{0:D}"/>
                        </li>

                        <li>
                            <label>Registration Token Ttl (sec)</label>
                            <input data-role="numerictextbox" data-bind="value:data.AppConfig.RegistrationAuthTokenTtl"
                                   id="RegistrationAuthTokenTtl" type="text" data-spinners="false"
                                   data-format="{0:D}"/>
                        </li>


                        <li>
                            <label>Session Record Delete Timeout (millisec)</label>
                            <input data-role="numerictextbox" data-bind="value:data.AppConfig.SessionRecordDeleteTimeout"
                                   id="SessionRecordDeleteTimeout" type="text" data-spinners="false"
                                   data-format="{0:D}"/>
                        </li>

                        <li>
                            <label>Whisperer Send PinInterval (millisec)</label>
                            <input data-role="numerictextbox" data-bind="value:data.AppConfig.WhispererSendPinInterval"
                                   id="WhispererSendPinInterval" type="text" data-spinners="false"
                                   data-format="{0:D}"/>
                        </li>

                    </ul>

                    <div style="position: absolute;bottom: 10px;right: 10px;">
                        <button id="save-app-config-btn" class="k-primary" style="width: 100px" data-bind="events: { click: onSave }">Save</button>
                    </div>


                </div>
            </li>
            <li>
                Db Config
                <div style="padding: 7px">
                    <ul class="config-list">
                        <li>
                            <label>Storage</label>
                            <span data-bind="text: data.DbConfig.storage"></span>
                        </li>


                        <li>
                            <label>Username</label>
                            <span data-bind="text: data.DbConfig.username"></span>
                        </li>
                    </ul>
                </div>
            </li>

        </ul>

    </div>

</script>

<script>

	function loadSettings(){

		var loadDash =  function(){

			viewDash  = new kendo.View("home",{
				model: new kendo.observable({
					data: settings,
					onSave:function(){

						$.ajax({
							type: "POST",
							url: '/settings/save',
							data: {data: JSON.stringify(this.data)},
							success: function(result){
								alert(result.success ? 'Settings saved' : result.error);
							},
							dataType: 'json'
						});


					}
				})
			});
			layout.showIn("#content", viewDash);
			$("#panelbar").kendoPanelBar({
				expandMode: "single"
			});

			setTimeout(function () {
				$("#panelbar").show();
			},50);

			$('#save-app-config-btn').kendoButton();
		};

		if(!settings){
			getSettings(loadDash);
        }
        else{
			loadDash();
        }

	}
</script>